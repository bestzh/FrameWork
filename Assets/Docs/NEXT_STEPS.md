# 项目下一步工作计划

## 📊 当前项目状态

### ✅ 已完成功能
1. **对话UI系统** - 完整的对话显示界面
2. **对话选项系统** - 支持玩家选择对话选项
3. **多段对话系统** - 支持对话树，多轮交互
4. **NPC交互系统** - NPC与玩家交互的基础框架

### ❌ 待完成功能（按优先级排序）

#### 🔴 高优先级

**1. 任务系统集成**
- [ ] 创建任务UI界面（Lua实现）
- [ ] 创建任务配置表（Lua配置）
- [ ] 集成QuestManager到Lua
- [ ] 实现通过对话选项接取任务
- [ ] 实现任务列表显示
- [ ] 实现任务进度追踪
- [ ] 实现任务完成和奖励发放

**2. 商店系统**
- [ ] 创建商店UI界面（Lua实现）
- [ ] 创建商店配置表（商品列表）
- [ ] 创建商店管理器（Lua）
- [ ] 实现商品购买逻辑
- [ ] 实现商品出售逻辑
- [ ] 集成到对话选项系统

#### 🟡 中优先级

**3. 技能系统**
- [ ] 创建技能UI界面（Lua实现）
- [ ] 创建技能配置表
- [ ] 创建技能管理器（Lua）
- [ ] 实现技能学习逻辑
- [ ] 实现技能升级逻辑
- [ ] 集成到对话选项系统

**4. 仓库系统**
- [ ] 创建仓库UI界面
- [ ] 实现物品存储逻辑
- [ ] 实现物品整理功能

#### 🟢 低优先级

**5. 强化系统**
- [ ] 创建强化UI界面
- [ ] 实现装备强化逻辑
- [ ] 实现强化效果

**6. 传送门系统**
- [ ] 创建副本选择UI
- [ ] 实现副本选择逻辑
- [ ] 实现场景切换

---

## 🎯 推荐下一步：任务系统集成

### 为什么先做任务系统？

1. **基础已存在** - `QuestManager.cs` 已经实现，只需要集成
2. **对话系统已就绪** - 可以直接通过对话选项接取任务
3. **核心玩法** - 任务是RPG游戏的核心循环之一
4. **相对简单** - 主要是UI和配置，逻辑相对简单

### 任务系统集成计划

#### 步骤1：创建任务配置表（Lua）✅ 已完成

**文件**: `Resources/lua/rpg/table/quest_config.lua.txt`

**已完成功能：**
- ✅ 任务配置表结构
- ✅ 支持多种任务目标类型（击杀敌人、收集物品、完成副本、达到等级、对话NPC）
- ✅ 任务奖励配置（经验、金币、物品）
- ✅ 任务前置条件（前置任务、等级要求）
- ✅ 可重复任务支持
- ✅ 辅助函数（获取任务、检查可接取性、获取描述等）

**配置的任务示例：**
- 新手任务：击败5只史莱姆
- 收集任务：收集10个草药
- 探索任务：完成暗影森林
- 日常任务：击败10只哥布林（可重复）
- 进阶任务：达到10级
- 对话任务：与铁匠对话

**使用方法：**
```lua
local QuestConfig = require("rpg.table.quest_config")

-- 获取任务配置
local quest = QuestConfig.GetQuest(1)

-- 获取NPC的任务列表
local quests = QuestConfig.GetQuestsByNPC(1)

-- 检查是否可以接取
local canAccept, reason = QuestConfig.CanAcceptQuest(1, playerLevel, completedQuests)
```

#### 步骤2：创建任务UI（Lua）

**文件**: `Resources/lua/ui/QuestUI.lua.txt`

需要实现：
- 任务列表显示
- 任务详情显示
- 任务进度显示
- 接取/放弃任务按钮

#### 步骤3：创建任务管理器（Lua）

**文件**: `Resources/lua/rpg/quest_manager.lua.txt`

需要实现：
- 调用C#的QuestManager
- 任务接取逻辑
- 任务进度更新
- 任务完成检查
- 任务奖励发放

#### 步骤4：集成到对话系统

在 `npc_controller.lua.txt` 中：
- 实现 `open_quest` 动作 - 打开任务UI
- 实现 `accept_quest` 动作 - 接取任务

#### 步骤5：创建任务UI预制体

在Unity中创建：
- 任务列表面板
- 任务详情面板
- 任务进度条
- 接取/放弃按钮

---

## 🏪 商店系统计划（任务系统完成后）

### 商店系统步骤

1. **创建商店配置表**
   - 商品列表
   - 商品价格
   - 商品库存

2. **创建商店UI**
   - 商品列表显示
   - 商品详情显示
   - 购买/出售按钮

3. **创建商店管理器**
   - 购买逻辑
   - 出售逻辑
   - 库存管理

4. **集成到对话系统**
   - `open_shop` 动作
   - `open_sell` 动作

---

## 📝 开发建议

### 开发顺序

1. **先做任务系统**（推荐）
   - 基础框架已存在
   - 相对简单
   - 核心功能

2. **再做商店系统**
   - 需要物品系统支持
   - 需要背包系统支持

3. **最后做技能系统**
   - 需要技能数据支持
   - 相对复杂

### 开发原则

1. **使用Lua实现UI逻辑** - 支持热更新
2. **配置表驱动** - 所有数据通过配置表管理
3. **模块化设计** - 每个系统独立，便于维护
4. **先实现核心功能** - 再完善细节

---

## 🚀 开始开发

准备好开始了吗？建议从**任务系统集成**开始！

需要我帮你：
1. 创建任务配置表？
2. 创建任务UI脚本？
3. 创建任务管理器？
4. 集成到对话系统？

告诉我你想从哪里开始！🎮

